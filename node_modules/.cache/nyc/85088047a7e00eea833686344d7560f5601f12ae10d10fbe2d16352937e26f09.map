{"version":3,"sources":["updateComment.js"],"names":["dotenv","config","updateSingleRecords","updateOneRecordsComment","req","res","receive_token_from_header","headers","authorization","decoded_token_in_the_way_to_obtain_user_details","jwt","verify","process","env","SECRET_KEY","body","createdBy","title","type","latitude","longitude","comment","recordId","parseInt","params","redflagid","data","impData","fetchOneRecord","status","json","message","username","userId","id","imgs","vids","files","images","imgsPath","map","path","join","videos","vidsPath","readyDatas","updatedRecord","updateComment","updateRecord"],"mappings":"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","sourceRoot":"C:\\Users\\Positivo_Computer\\Desktop\\broadcaster-andela-cycle-13\\server\\v1\\api\\controllers","sourcesContent":["import dotenv from 'dotenv';\r\nimport jwt from 'jsonwebtoken';\r\nimport impData from '../models/DB';\r\nimport impDataFromToken from '../helpers/token';\r\n\r\ndotenv.config();\r\nconst updateSingleRecords = {\r\n  updateOneRecordsComment(req, res) {\r\n    const receive_token_from_header = req.headers.authorization;\r\n    const decoded_token_in_the_way_to_obtain_user_details = jwt.verify(receive_token_from_header, process.env.SECRET_KEY);\r\n    const { createdBy, title, type, latitude, longitude, comment } = req.body;\r\n\r\n    const recordId = parseInt(req.params.redflagid);\r\n    const data = impData.fetchOneRecord(recordId);\r\n\r\n    if (!recordId) {\r\n      return res.status(404).json({ status: 404, message: `Hey ${decoded_token_in_the_way_to_obtain_user_details.username} insert record id ` });\r\n    }\r\n\r\n    if (!data) {\r\n      return res.status(404).json({ status: 404, message: `Hey ${decoded_token_in_the_way_to_obtain_user_details.username} this record with id ${recordId} is not found ` });\r\n    }\r\n    if (data.userId !== decoded_token_in_the_way_to_obtain_user_details.id) {\r\n      return res.status(400).json({ status: 400, message: `Hey ${decoded_token_in_the_way_to_obtain_user_details.username} you are not owner of this record with id ${recordId} ` });\r\n    }\r\n\r\n    let imgs;\r\n    let vids;\r\n    if (req.files) {\r\n      if (req.files.images) {\r\n        const imgsPath = req.files.images.map(({ path }) => path);\r\n        imgs = imgsPath.join(',  ');\r\n      }\r\n      if (req.files.videos) {\r\n        const vidsPath = req.files.videos.map(({ path }) => path);\r\n        vids = vidsPath.join(',  ');\r\n      }\r\n    }\r\n\r\n    const readyDatas = {\r\n      userId: decoded_token_in_the_way_to_obtain_user_details.id,\r\n      createdBy: createdBy,\r\n      title: title,\r\n      type: type,\r\n      latitude: latitude,\r\n      longitude: longitude,\r\n      images: imgs,\r\n      videos: vids,\r\n      comment: comment,\r\n    };\r\n    const updatedRecord = impData.updateComment(parseInt(req.params.redflagid), readyDatas);\r\n    return res.status(200).json({ status: 200, message: `Hey ${decoded_token_in_the_way_to_obtain_user_details.username} !! Your record with id ${recordId} was updated Successfully `, updateRecord: updatedRecord });\r\n  },\r\n};\r\nexport default updateSingleRecords;\r\n"]}